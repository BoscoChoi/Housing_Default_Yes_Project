<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Next Stop: Homes? Is the Government’s Push for a “Default Yes” for Housebuilding Close to Train Stations a Good Idea?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="qm_final_assm_files/libs/clipboard/clipboard.min.js"></script>
<script src="qm_final_assm_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="qm_final_assm_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="qm_final_assm_files/libs/quarto-html/popper.min.js"></script>
<script src="qm_final_assm_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="qm_final_assm_files/libs/quarto-html/anchor.min.js"></script>
<link href="qm_final_assm_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="qm_final_assm_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="qm_final_assm_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="qm_final_assm_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="qm_final_assm_files/libs/bootstrap/bootstrap-2382116cebcc9b40dc8f035bcec9a280.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"></a></li>
  <li><a href="#technical-appendix" id="toc-technical-appendix" class="nav-link" data-scroll-target="#technical-appendix"><strong>Technical Appendix</strong></a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="qm_final_assm.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><p>Next Stop: Homes?<br>
Is the Government’s Push for a “Default Yes” for Housebuilding Close to Train Stations a Good Idea?</p></h1>
<p class="subtitle lead">Planning Opinions</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p>London has again fallen short of its housing targets. The first 9 months of 2025 saw only around <a href="https://www.savills.co.uk/blog/article/382106/residential-property/changes-incoming-to-london-s-planning-system---solving-london-s-housing-crisis-.aspx">3,000 units</a> of private housing being started, well behind the Mayor’s target of 52,000 new homes per year. The government has already tried to remove regulatory barriers to speed up housing supply, by relaxing Greenbelt restrictions for housebuilding and removing dual-aspect requirement for new-built London homes. Now, here is another one: <a href="https://www.gov.uk/government/news/housebuilding-around-train-stations-will-be-given-default-yes">a “default yes” for housebuilding close to train stations</a>.</p>
<p>In the proposed reforms to the National Planning Policy Framework, the government announced their intention to support housing proposals around train stations, with a “default yes” to planning applications within a reasonable walking distance of well-connected stations.</p>
<p>What’s a “reasonable walking distance” has not been explicitly defined, but Matthew Pennycook, the Minister for Housing and Planning, suggested that <a href="https://hansard.parliament.uk/commons/2025-12-16/debates/2B9FAE0D-691F-4D79-86D0-3D4C1B51D6E3/PlanningReform">800m</a> could be a possibility. For well-connected stations, they have to be served by 4 trains per hour, or 2 trains per hour in any direction, on weekdays<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>These interventions are framed as ways to encourage building right homes in the right places, and to “get Britain building” by lowering time and financial costs for developers in the lengthy planning application processes.</p>
<div id="44f8a5f9" class="cell" data-execution_count="21">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>A dive into the planning applications database revealed that in the past 5 years, only <strong>25%</strong> of the <a href="https://www.planninggeek.co.uk/planning/applications/minor-or-major-planning/">major residential applications</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> were decided within the statutory time limit of <a href="https://www.gov.uk/guidance/determining-a-planning-application">13 weeks</a>.</p>
<p>Considerable attention should be given to the 800m radius, as <strong>81%</strong> of the major residential applications were located within 800m from a train station. Based on historical trends, setting the boundary at 800m means that a significant proportion of major housing schemes can be going through the default approval route in the future, without considering extra stimulation effects brought by the new policy.</p>
<p>Assuming wildly that decision time can be cut by 25% for all those on the default route, this could translate into a rough total per-year saving of <strong>68</strong> years from the time taken to get planning decisions in London. Obviously, this would depend on the complexity of the conditions to be fulfilled by the developer in order to convert a “default yes” into an “actual yes”.</p>
<div id="12e9609d" class="cell" data-execution_count="27">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>While it seems like there is a considerable potential for speeding up housebuilding brought by the “default yes”, it does not appear like the planning system has been blocking new housing in London, seeing that only <strong>7%</strong> of the proposed homes were given red light eventually. Contrary to <a href="https://lichfields.uk/blog/2025/december/16/all-aboard-or-stuck-between-stations-how-the-new-nppf-might-unlock-growth-around-rail-stations">some analysts’ optimism</a> about the development that can be “unlocked” near stations, an additional tilt towards green-lighting housebuilding near stations itself is unlikely to bring substantially more housing, at least not for London, when the vast majority of housing schemes, especially large-scale ones, have already been supported. Instead, a further tilt in the balance might bring worries about quality.</p>
<p>Another caveat is that the 800m buffer seems to be too blunt. Despite strong national and London-wide planning policy support for building in sustainable locations before the “default yes” came out, approval rate did not show significant differences across the 800m boundary. Does the 800m buffer provide a good estimation of whether the location is sustainable?</p>
<div id="07d4e0e5" class="cell" data-execution_count="29">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>To answer the question, we can look at the dataset of <a href="https://experience.arcgis.com/experience/4c88d5310df34e21bcb3a50ae9c0a159/page/PTAL-Query?block_id=layout_276_block_11&amp;intcmp=26162">Public Transport Accessibility Level (PTAL)</a> from TfL, which considers not only distance to public transport but also service frequency, and includes a range of transport options.</p>
<p>Based on this dataset, we can see that between all neighbourhoods in London, public transport accessibility can still vary significantly even with the same distance to a nearest train station, not to mention that within the 800m buffer, there can be variations in accessibility between locations of different distances to stations. A simple 2-categories cut at 800m does not represent accessibility very well.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div id="9ccbb404" class="cell" data-execution_count="34">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>When we break approval rates down by PTAL, a clearer pattern emerges: areas with better public transport accessibility tend to see much higher approval rates, except for PTAL 6a. This approach reveals far more nuance than a simple 800-metre rule, and it takes more transport modes and their frequencies into account. Building this into the “default yes” policy would give a more holistic picture.</p>
<p>The government indeed tried to define “well-connected stations” using a single threshold for train frequency. But 2 trains per hour in any direction does not seem too difficult to meet for most of London’s train stations. When we have a handy PTAL dataset for London, why not use it to set more graduated levels of support for housebuilding based on how accessible an area really is—perhaps through the next London Plan? It may be more complex to administer, but it would better ensure right homes in the <em>right</em> places.</p>
<p>Anyways, to help strengthen the emphasis of developing in sustainable locations, I have classified London neighbourhoods into several clusters to close off this week’s <em>Planning Opinions</em>. Clusters are grouped based on existing neighbourhood density, PTAL levels, and distance to train stations. The green areas on the map below highlights opportunity areas for further densification and development, since they have lower existing density, and good public transport accessibility with train stations very nearby. On the list of green areas, we have New Cross, Peckham, Kennington, Clapham, Mile End, Hampstead, Barking, etc.</p>
<div id="2f0fc905" class="cell" data-execution_count="39">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1895ea6d" class="cell" data-execution_count="40">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The “default yes” policy might speed up housing supply, more through time-cost saving rather than through improved chances of approval. While its causes are laudable, its methodology ought to be more refined, and the quality that is sacrificed for speed deserves our attention. <a href="https://www.gov.uk/government/consultations/national-planning-policy-framework-proposed-reforms-and-other-changes-to-the-planning-system">Consultation about the new policy</a> is now in progress, and some details are still in the mist. We will wait and see how it goes.</p>
<p>(996 words)</p>
<div style="page-break-after: always;"></div>
</section>
<section id="technical-appendix" class="level2">
<h2 class="anchored" data-anchor-id="technical-appendix"><strong>Technical Appendix</strong></h2>
<p>The following bits might be a bit harder to read, but if you are interested in diving deeper, this section sets out some further evidence, and evaluates the robustness of the arguments I have made.</p>
<section id="additional-analysis-materials" class="level4">
<h4 class="anchored" data-anchor-id="additional-analysis-materials">Additional Analysis Materials</h4>
<div id="110714e1" class="cell" data-execution_count="42">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As shown above, PTAL Access Index demonstrates stronger correlation with existing housing density compared to distance to train stations. Also, depending on whether log-transformed, distance to train stations only explains about <strong>21%</strong> to <strong>41%</strong> of the variations in transport accessibility.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> These further reinforce the call for taking finer PTAL measures into account, if we are to give the right level of support to housebuilding at the location with the right level of transport sustainability.</p>
<div id="00b50109" class="cell" data-execution_count="43">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d448ff5c" class="cell" data-execution_count="44">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Since the datasets have long-tail distributions, they were log-transformed in the main article’s scatter plot to better uncover and visualise the correlation.</p>
</section>
<section id="dealing-with-the-planning-applications-database-behind-the-scenes" class="level4">
<h4 class="anchored" data-anchor-id="dealing-with-the-planning-applications-database-behind-the-scenes">Dealing with the planning applications database – behind the scenes</h4>
<p>Major planning applications were queried from the <a href="https://planningdata.london.gov.uk/dashboard/app/kibana_overview#/">Planning London Datahub</a><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> by connecting to its public API and writing an Elastic Search Query to filter for applications with valid dates from 2021 to 2025 and with 10 or more proposed residential units. <strong>2,215</strong> records were initially obtained. In the data cleaning process, I first inspected the decisions field, and removed <strong>204</strong> records that do not have a definite decision (for example, being shown as undetermined, referred to higher-level government, etc.). I grouped other decision values to either “approved” or “refused” using my understanding of the planning system. I then removed another <strong>212</strong> records that do not have valid coordinate locations.</p>
<p>Despite their regular checking, <a href="https://www.london.gov.uk/programmes-strategies/planning/digital-planning/planning-london-datahub?ac-60574=60569">the GLA cannot guarantee data accuracy</a> as the data were submitted to the GLA by independent boroughs. If there are many missing values in the proposed number of dwellings field of the database, the dataset I started with can be largely incomplete. To sense-check that the number of applications fetched is a good approximation of the actual number of major residential applications in London, I compared it against the number of major residential applications decided in a London borough per year. For example, this figure would be around <a href="https://www.ealing.gov.uk/download/downloads/id/21149/barriers_to_delivery_and_action_plan.pdf">15 for LB Ealing</a> on average. Multiplying 15 by 32 boroughs and then by 5 years, we get 2400 applications, roughly near the number of <strong>2,215</strong>.</p>
</section>
<section id="clustering-behind-the-scenes" class="level4">
<h4 class="anchored" data-anchor-id="clustering-behind-the-scenes">Clustering – behind the scenes</h4>
<p>K-means clustering was used to group Lower Layer Super Output Areas (LSOAs) in London into clusters based on the 3 following variables, all of which display strong positive spatial autocorrelation seen from the Moran’s I values. This resulted in geographically coherent clusters even when I did not impose spatial constraints to the clustering.</p>
<div id="066f4433" class="cell" data-execution_count="45">
<div class="cell-output cell-output-display" data-execution_count="91">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Moran's I</th>
<th data-quarto-table-cell-role="th">P-value</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Variable</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">PTAL Access Index</td>
<td>0.836437</td>
<td>0.001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Distance to Train Station</td>
<td>0.757858</td>
<td>0.001</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Existing dwellings per hectare</td>
<td>0.500683</td>
<td>0.001</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="8a3c00ff" class="cell" data-execution_count="46">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="qm_final_assm_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Purely based on the Elbow plot, 6 clusters appears to be a good balance between minimising inertia and retaining interpretability. However, to better pick up nuances and allow for opportunity areas for further densification to be identified, I chose to have 7 clusters instead.</p>
</section>
<section id="limitations-of-raw-data" class="level4">
<h4 class="anchored" data-anchor-id="limitations-of-raw-data">Limitations of raw data</h4>
<p>Other than the data quality issue of missing entries, the planning applications database also has another inherent weakness: the same scheme can sometimes have more than one associated application. It can get refused at first, be revised and approved after re-submission. The data also contains some applications made to vary existing applications. Therefore, some cases can be over-represented in the database, affecting the estimation of decision times and approval rates. My analysis results should not be used to measure housing delivery, for the reasons above, as well as that having a permission does not mean the developer would necessarily start construction.</p>
<p>Moreover, the PTAL dataset <a href="https://content.tfl.gov.uk/connectivity-assessment-guide.pdf">does not account for</a> travel destinations available at each location. It equally does not reflect service quality.</p>
</section>
<section id="limitations-of-my-methodology" class="level4">
<h4 class="anchored" data-anchor-id="limitations-of-my-methodology">Limitations of my methodology</h4>
<p>The 800m buffer was set on the basis of Euclidean distance throughout the analysis, since the future detailed policies may also adopt an Euclidean approach for easy administration. A buffer based on travel time mapping, however, will provide a more accurate reflection of the actual walkable route from the train station.</p>
<p>In the clustering, I used dwellings per hectare to identify where to densify. Yet, dwelling density is only a proxy of building density<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. In office-predominant areas further densification is difficult, but they could be highlighted as opportunity areas in the map. Also, the map only provides broad-stroke opportunity areas for high-level strategic planning. It has not been overlayed with actual site constraints/planning designations preventing development.</p>
</section>
<section id="limitations-of-my-arguments" class="level4">
<h4 class="anchored" data-anchor-id="limitations-of-my-arguments">Limitations of my arguments</h4>
<p>Building more in accessible places, no matter through considering PTAL as I argue for, or through setting a train frequency threshold that the government proposes, grounds on the assumption that transport infrastructure remains static during development. Yet, in reality, train companies might, subject to technical feasibility, increase train frequency when a batch of new residents move in around the station. New stations can also be built in strategic growth areas. This reflects a classic chicken-egg dilemma between housing and infrastructure. My data analysis still sits within the frame of developing in transit-oriented locations, but the alternative frame of developing a location to make it transit-oriented is also valid to an extent.</p>
</section>
<section id="further-research-area" class="level4">
<h4 class="anchored" data-anchor-id="further-research-area">Further research area</h4>
<p>Since the government also proposed that residential applications around train stations would be refused if they do not reach at least 40-50 dwellings per hectare in the net developable area of the site, it will be equally interesting to investigate how many past major residential applications in London have already met this threshold. I have faced significant difficulty in trying to clean up the site area field from the applications database as its values have mixed units in either m<sup>2</sup> or hectares, so I did not go down this route. However, this remains an interesting possibility for further research.</p>
</section>
<section id="full-reproducible-code" class="level4">
<h4 class="anchored" data-anchor-id="full-reproducible-code">Full reproducible code</h4>
<p>The reproducible .qmd file used to generate this analysis piece can be found on my GitHub by clicking <a href="https://github.com/BoscoChoi/Housing_Default_Yes_Project">here</a>.</p>
<p>(999 words)</p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is an additional criterion of being located in a top 60 <a href="https://www.ons.gov.uk/economy/economicoutputandproductivity/publicservicesproductivity/articles/productivityintownsandtraveltoworkareasuk/2019">Travel to Work Area</a> by Gross Value Added, but London surely meets the requirement.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Defined as applications with 10 or more dwellings proposed<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>See appendix for more details<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Figures are obtained through getting R-squared by squaring Pearson Correlation Coefficient<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Dataset by the GLA<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Measured in floor-area-ratio (FAR)<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>